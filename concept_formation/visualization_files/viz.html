<!DOCTYPE html>
<html>
  <head>
    <title>Trestle Viz</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="viz_styling.css">
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div id="plot-panel" class="col-md-9 col-sm-8 col-xs-12">
          <div>
            <svg class="svg-content-responsive" viewBox="0 0 750 750" preserveAspectRatio="xMinYMin meet"></svg>
          </div>
        </div>
        <div id="property-container" class="col-md-3 col-sm-4 col-xs-6">
          <div id="property-panel">
            <div class="input-group">
              <input id="search-concept-name" type="text" class="form-control" placeholder="Concept#">
              <span class="input-group-btn">
                <button id="search-concept-go" class="btn btn-default" type="button">Search</button>
              </span>
            </div>
            <span id="search-not-found" class="text-danger"></span>
            <!-- <h3>Current Concept</h3> -->
            <table class="table table-condensed">
              <tbody>
                <tr>
                  <td class="concept-prop"><strong>Concept Name</strong></td>
                  <td class="absorbing-column" id="concept-name"></td>
                </tr>
                <tr>
                  <td class="concept-prop"><strong>Size</strong></td>
                  <td class="absorbing-column" id="concept-size"></td>
                </tr>
                <tr>
                  <td class="concept-prop"><strong>N Children</strong></td>
                  <td class="absorbing-column" id="concept-child-size"></td>
                </tr>
              </tbody>
            </table>
            
            <h3>
              <a data-toggle="collapse" href="#settings-collapse" class="collapse-header">Settings 
                <span class="glyphicon glyphicon-menu-left pull-right collapse-arrow"></span>
              </a>
            </h3>
            <div class="collapse" id="settings-collapse">
              <label>Image Field
              <select id="img-attr">
                <option value="none">None</option>
              </select>
              </label><br/>
              <label><strong>Treat Binary Values as</strong>
                <select id="binary-style">
                  <option value="continuous">Continuous</option>
                  <option value="categorical">Categorical</option>
                </select>
              </label>
              <br/>
              <strong>Hide Properties</strong>
              <form id="filter-form">
                <div class="form-group">
                  <div class="checkbox"><label><input id="fil-val-unique" class="filter-check" type="checkbox" >Unique Values</label></div>
                  <div class="checkbox"><label><input id="fil-val-constant" class="filter-check" type="checkbox" >Constant Values</label></div>
                  <div class="checkbox"><label><input id="fil-val-binary" class="filter-check" type="checkbox" >Binary Values</label></div>
                  <div class="checkbox"><label><input id="fil-val-numeric" class="filter-check" type="checkbox" >Numeric Values</label></div>
                  <div class="checkbox"><label><input id="fil-val-nominal" class="filter-check" type="checkbox" >Nominal Values</label></div>
                  <div class="checkbox"><label><input id="rel-filter" class="filter-check" type="checkbox" >Relations Attribtues</label></div>
                  <div class="checkbox"><label><input id="hid-filter" class="filter-check" type="checkbox" >Hidden Attributes</label></div>
                  <div class="checkbox"><label><input id="com-filter" class="filter-check" type="checkbox" >Component Property Attributes</label></div>
                </div>
              </form>
            </div>

            <h3 id="cluster-heading">
              <a data-toggle="collapse" href="#cluster-collapse" class="collapse-header">Clusters
                <span class="glyphicon glyphicon-menu-down pull-right collapse-arrow"></span>
              </a>
            </h3>
            <div class="collapse in" id="cluster-collapse">
              <label><strong>Clustering Layout</strong>
                <select id="cluster-style">
                  <option value="attr">Attributes</option>
                  <option value="dist">Distance</option>
                </select>
              </label><br/>
              <label><strong>Cluster Size</strong>
                <select id="cluster-sizing">
                  <option value="abs">Absolute</option>
                  <option value="rel">Relative</option>
                  <option value="equ">Equal</option>
                </select>
              </label><br/>
              <div id="attr-cluster-settings">
                <label><strong>X-Axis Attribute</strong>
                  <select id="x-axis-attr" class="attr-axis">
                    <option value="none">None</option>
                  </select>
                </label><br/>
                <label><strong>Y-Axis Attribute</strong>
                  <select id="y-axis-attr" class="attr-axis">
                    <option value="none">None</option>
                  </select>
                </label>
              </div>
              <div id="dist-cluster-settings">
                <label><strong>Anchor 1</strong>
                  <select id="anchor-1" class="dist-anchor">
                    <option value="none">None</option>
                  </select>
                </label><br/>
                <label><strong>Anchor 2</strong>
                  <select id="anchor-2" class="dist-anchor">
                    <option value="none">None</option>
                  </select>
                </label>
              </div>
            </div>
            
            <h3>
              <a data-toggle="collapse" href="#attr-explorer-collapse" class="collapse-header">Attribute Explorer
                <span class="glyphicon glyphicon-menu-down pull-right collapse-arrow"></span>
              </a>
            </h3>
            <div class="collapse in" id="attr-explorer-collapse">
              <label><strong>Focus Attribute</strong>
                <select id="focus-attr">
                  <option value="none">None</option>
                </select>
              </label>
              <table class="table table-condensed">
                <tbody>
                  <tr>
                    <td class="concept-prop"><strong>Attribute Type</strong></td>
                    <td class="absorbing-column" id="focus-attr-type">Default</td>
                  </tr>
                  <tr>
                    <td class="concept-prop"><strong>Value Type</strong></td>
                    <td class="absorbing-column" id="focus-val-type">Default</td>
                  </tr>
                </tbody>
              </table>
              <div id="nominal-colors" class="color-ops">
                <table class="table table-condensed">
                  <thead>
                    <tr>
                      <td class="absorbing-column"><strong>Value</strong></td>
                      <td><strong>Color</strong></td>
                    </tr>
                  </thead>
                  <tbody id="nom-val-colors">
                  </tbody>
                </table>
              </div>
              <div id="numeric-colors" class="color-ops">
                <div class="progress">
                  <div id="num-col-1" class="progress-bar num-swatch"></div>
                  <div id="num-col-2" class="progress-bar num-swatch"></div>
                  <div id="num-col-3" class="progress-bar num-swatch"></div>
                  <div id="num-col-4" class="progress-bar num-swatch"></div>
                  <div id="num-col-5" class="progress-bar num-swatch"></div>
                  <div id="num-col-6" class="progress-bar num-swatch"></div>
                  <div id="num-col-7" class="progress-bar num-swatch"></div>
                  <div id="num-col-8" class="progress-bar num-swatch"></div>
                  <div id="num-col-9" class="progress-bar num-swatch"></div>
                </div>
                <div class="row">
                  <div id="num-val-1" class="col-md-4" style="text-align:left"></div>
                  <div id="num-val-5" class="col-md-4" style="text-align:center"></div>
                  <div id="num-val-9" class="col-md-4" style="text-align:right;"></div>
                </div>
              </div>
            </div>
            
            <h3>
              <a data-toggle="collapse" href="#av-table-collapse" class="collapse-header">Attribute-Value Table 
                <span class="glyphicon glyphicon-menu-down pull-right collapse-arrow"></span>
              </a>
            </h3>
            <div class="collapse in" id="av-table-collapse">
              <table id="property-sheet" class="table table-bordered table-condensed av-table">
                <thead>
                  <tr>
                    <td class="prop-column"><b>Property</b></td>
                    <td class="count-column"><b>Count</b></td>
                    <td class="perc-column"><b>Percent</b></td>
                  </tr>
                </thead>
                <tbody id="properties">
                </tbody>
              </table>
            </div>
          
          </div>
        </div>
      </div>
      <script src="https://d3js.org/d3.v4.js"></script>
      <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
      <script type="text/javascript" src="output.js"></script>
      <script type="text/javascript" src="viz_tools.js"></script>
      <script type="text/javascript" src="tree_viz.js"></script>
      <script type="text/javascript" src="cluster_viz.js"></script>
      <script type="text/javascript">
      $("document").ready(function(){
        if(typeof window.trestle_output === 'undefined'){
          alert("Can't find the trestle output data. Use visualize(tree) to output an appropriate tree.");
        }
        else if (typeof d3 === 'undefined'){
          alert("Can't find the d3 library. Currently the viz assumes it can get it from a CDN on the internet so it won't work if you are offline.")
        }
        else {
          var renderer = undefined;
          if(window.extra_data) {
            renderer = new ClusterRenderer(window.trestle_output);
          }
          else {
            renderer = new TreeRenderer(window.trestle_output);
          }
          renderer.render();
          renderer.updateFilters();

          $("#focus-attr").change(renderer.colorSelectChanged);
          $(".filter-check").change(renderer.updateFilters);
          $("#img-attr").change(renderer.imageSelectChanged)
          $("#search-concept-go").click(renderer.searchConceptByName);
          $("#search-concept-name").change(renderer.searchConceptByName);
          $("#binary-style").change(renderer.colorSelectChanged);

          $(".collapse-header").click(function(e){
            $(e.target).children().toggleClass("glyphicon-menu-left");
            $(e.target).children().toggleClass("glyphicon-menu-down");
          });

          $(".collapse-arrow").click(function(e){
            $(e.target).toggleClass("glyphicon-menu-left");
            $(e.target).toggleClass("glyphicon-menu-down");
          });
        }
      });
      </script>
    </div>

</body>
</html>